!function(){var e=function(){var e=null,t=null,n=[],o=!0,i=0,r=!1;Helper={mergeObject:function(e,t){for(var n in t)try{e[n]=t[n].constructor==Object?this.mergeObject(e[n],t[n]):t[n]}catch(o){e[n]=t[n]}return e},wrapCanvasText:function(e,t,n,o){"undefined"==typeof o&&(o=0);var i=e.split(" "),r="",a=e.replace(/(\r\n|\n|\r)/gm,""),l=new fabric.Text(a,{fontFamily:e.fontFamily,fontSize:25}).height,f=o>0?o-l:0,c=t.getContext("2d");c.font=e.fontSize+"px "+e.fontFamily;for(var u="",d=0,h=0;h<i.length;h++){var s=""==u,m=u+" "+i[h],p=c.measureText(m).width;if(n>p)u+=i[h]+" ",r+=i[h]+=" ";else{if(s)for(var g="",v=0;v<i[h].length;++v){g+=i[h].charAt(v);var b=g+"-";if(c.measureText(b).width>=n){b=g.substr(0,g.length-2)+"-",i[h]=i[h].substr(g.length-1,i[h].length),r+=b;break}}h--,r+="\n",d++,u=""}if(f>0&&d*l>f){r=r.substr(0,r.length-3)+"...\n";break}}return r=r.substr(0,r.length-1)},removeObjects:function(e,t){for(var n=0;n<t.length;n++)e.remove(t[n]);t=[],e.renderAll()},renderContent:function(e,t,i,r){Helper.removeObjects(e,n);var l=null==t.text?500:500*t.text.split(" ").length;l<a.minDuration&&(l=a.minDuration),i?fabric.Image.fromURL(t.bgImage,function(t){t.scaleToWidth(e.width),t.scaleToHeight(e.height),t.top=0,t.originX="center",e.add(t),e.centerObject(t),e.setActiveObject(t),e.renderAll(),n.push(t),r&&setInterval(function(){r()},1e3)}):fabric.Image.fromURL(t.bgImage,function(i){i.setLeft(-e.width),i.scaleToWidth(e.width),i.scaleToHeight(e.height),i.top=0,i.originX="center",e.add(i),n.push(i),i.animate("left",e.width/2,{onChange:e.renderAll.bind(e),onComplete:function(){i.animate("height",i.height+100,{onChange:e.renderAll.bind(e),duration:l,onComplete:function(){t.onHalfComplete&&t.onHalfComplete(),o&&r&&r()}}),i.animate("width",i.width+100,{onChange:e.renderAll.bind(e),duration:l})}});var f=new fabric.Text(Helper.wrapCanvasText(t.text,e,e.width/3,e.height-100),{top:0,left:-e.width,fontFamily:t.fontFamily?t.fontFamily:a.fontFamily,fontSize:t.fontSize?t.fontSize:a.fontSize,fill:t.fontColor?t.fontColor:a.fontColor,fontWeight:t.fontWeight?t.fontWeight:a.fontWeight});f.setTop(e.height-(f.height+20)),f.originX="center",e.add(f),n.push(f),f.animate("left",e.width/2,{onChange:e.renderAll.bind(e)}),e.renderAll()})}};var a={canvasId:"c",audio:"https://s3.amazonaws.com/sounds.wideo.co/6.mp3",fontColor:"#ffffff",fontFamily:"Arial,Helvetica,sans-serif",fontSize:30,fontWeight:"200",minDuration:1e3},l=function(t){a=Helper.mergeObject(a,t),a.onHalfComplete&&a.data.forEach(function(e,t){t==parseInt(a.data.length/2)&&(e.onHalfComplete=a.onHalfComplete)}),e=new fabric.Canvas(a.canvasId),fabric.Object.prototype.selectable=!1},f=function(){i==a.data.length-1&&(a.onStop&&a.onStop(),r=!0),Helper.renderContent(e,a.data[i++],r,function(){r?c(!1):f()})},c=function(e){if(t){if(e)return void t.pause();var n=setInterval(function(){if(t.volume>0)try{t.volume=t.volume-.09}catch(e){clearInterval(n),t.pause()}else clearInterval(n),t.pause()},150)}};return l.prototype.start=function(){i=0,r=!1,o=!0,a.onStart&&a.onStart(),t=a.audio?new Audio(a.audio):null,t.play(),f()},l.prototype.stop=function(){o=!1,Helper.removeObjects(e,n),c(!0)},l}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=e:"function"==typeof define&&define.amd?define([],function(){return e}):window.CanvasSequence=e}();